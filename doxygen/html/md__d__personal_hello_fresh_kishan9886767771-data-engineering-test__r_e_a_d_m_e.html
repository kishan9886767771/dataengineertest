<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Hello Fresh: Solution for HelloFresh Data Engineering Test</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Hello Fresh
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">HelloFresh is a Package to Read json and Calculate average cooking time duration per difficulty level using pyspark.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__d__personal_hello_fresh_kishan9886767771-data-engineering-test__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Solution for <a class="el" href="namespace_hello_fresh.html" title="HelloFresh is a Package to Read json and Calculate average cooking time duration per difficulty level...">HelloFresh</a> Data Engineering Test </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Solution for <a class="el" href="namespace_hello_fresh.html" title="HelloFresh is a Package to Read json and Calculate average cooking time duration per difficulty level...">HelloFresh</a> Data Engineering Test is builded as a python package for easy integration for other applications.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Approach and Data Exploration</h1>
<p>Applicaton is written as a package(HelloFresh) and which has been imported in <a class="el" href="run_8py.html">run.py</a> to need the given requirements in the problem statement.</p>
<p>While creating an instance of <a class="el" href="namespace_hello_fresh.html" title="HelloFresh is a Package to Read json and Calculate average cooking time duration per difficulty level...">HelloFresh</a> Class, which expects 1 argument i.e, URI for json data (as per problem statement an Amazon s3 (<a href="https://s3-eu-west-1.amazonaws.com/dwh-test-resources/recipes.json">https://s3-eu-west-1.amazonaws.com/dwh-test-resources/recipes.json</a>) URI is passed as argument while creating <a class="el" href="namespace_hello_fresh.html" title="HelloFresh is a Package to Read json and Calculate average cooking time duration per difficulty level...">HelloFresh</a> Instance in <a class="el" href="run_8py.html">run.py</a> line 4)</p>
<p>Instance init will set the variables to default values and perform the get request for given uri, extract json from response and constructs spark dataframe as df.</p>
<p>Method config() is used on created instance to set the upperbound of easy difficulty and lowerbound of hard difficulty, medium difficulty will be considered as between easy and hard.</p>
<p>Method get() is used on configured instance with 1 potential argument keyword, Which will be used to Filter Spark Dataframe with ingredients. This method will Extract Cook Time and Prep Time for filtered data in Spark Dataframe.</p>
<p>After Extracting Cook Time and Prep Time, String Data (xHxM) will be converted to integer minutes and compute average Total Time for Each difficulty (i.e, Easy, Medium, Hard), which will be segregated based on configued values from config() method.</p>
<p>Method save() will take filepath as a argument. If path doen't exist, It will create path tree and stores the output as given filename (Ex: report.csv inside output dir).</p>
<p>Method __ str__() has been defined for ease use in print statements or to extract output string from object.</p>
<p><b>API Documentation and Call Graphs for <a class="el" href="namespace_hello_fresh.html" title="HelloFresh is a Package to Read json and Calculate average cooking time duration per difficulty level...">HelloFresh</a> Package is documented using Doxygen, Output of Doxygen can be found in doxygen dir (doxygen/html/index.html)</b></p>
<p><b>CI / CD and Performance Tuning is Explained in CI_CD&amp;Performance_tuning.docx file</b></p>
<h1><a class="anchor" id="autotoc_md2"></a>
Assumptions / Considerations</h1>
<ul>
<li>Dataset is available from an s3 (or alternate request) urls.</li>
<li>Request url should return a json data.</li>
<li>OpenJDK Version should be greater than 1.8</li>
<li>Running with python 3.x</li>
<li>Following python packages are installed: &ndash; pyspark == 3.0.0 &ndash; requests == 2.23.0</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Executing the solution</h1>
<p>To Execute the Spark Application with N CPUs and nGB driver memory </p><div class="fragment"><div class="line">spark-submit --master local[*] --executor-cores=%NUMBER_OF_PROCESSORS% --driver-memory 4G run.py</div>
</div><!-- fragment --><p>or simply run </p><div class="fragment"><div class="line">python run.py</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Unit Test</h1>
<p>Unit test for application is done based on unittest framework in python. There are 6 test cases written to perform full-loop unit tests on package <a class="el" href="namespace_hello_fresh.html" title="HelloFresh is a Package to Read json and Calculate average cooking time duration per difficulty level...">HelloFresh</a> can be found in <a class="el" href="test_8py.html">test.py</a> To perform unit test on the module, Run the <a class="el" href="test_8py.html">test.py</a> with following command: </p><div class="fragment"><div class="line">python test.py</div>
</div><!-- fragment --><p>Output: </p><div class="fragment"><div class="line">Using Spark&#39;s default log4j profile: org/apache/spark/log4j-defaults.properties</div>
<div class="line">Setting default log level to &quot;WARN&quot;.</div>
<div class="line">To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).</div>
<div class="line">C:\Users\Admin\AppData\Local\Programs\Python\Python36\lib\site-packages\pyspark\sql\session.py:378: UserWarning: inferring schema from dict is deprecated,please use pyspark.sql.Row instead</div>
<div class="line">  warnings.warn(&quot;inferring schema from dict is deprecated,&quot;</div>
<div class="line">C:\Users\Admin\AppData\Local\Programs\Python\Python36\lib\socket.py:657: ResourceWarning: unclosed &lt;socket.socket fd=1028, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=(&#39;127.0.0.1&#39;, 59256), raddr=(&#39;127.0.0.1&#39;, 59255)&gt;</div>
<div class="line">  self._sock = None</div>
<div class="line">...</div>
<div class="line">----------------------------------------------------------------------</div>
<div class="line">Ran 6 tests in 9.256s</div>
<div class="line"> </div>
<div class="line">OK</div>
<div class="line"> </div>
<div class="line">SUCCESS: The process with PID 19388 (child process of PID 18880) has been terminated.</div>
<div class="line">SUCCESS: The process with PID 18880 (child process of PID 5496) has been terminated.</div>
<div class="line">SUCCESS: The process with PID 5496 (child process of PID 16276) has been terminated.</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
Code Coverage</h1>
<p>Code Coverage is tested with python's coverage package, to install coverage package run the following command </p><div class="fragment"><div class="line">pip install coverage==5.3</div>
</div><!-- fragment --><p>To Run Code Coverage </p><div class="fragment"><div class="line">coverage run test.py</div>
</div><!-- fragment --><p>Output: </p><div class="fragment"><div class="line">Using Spark&#39;s default log4j profile: org/apache/spark/log4j-defaults.properties</div>
<div class="line">Setting default log level to &quot;WARN&quot;.</div>
<div class="line">To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).</div>
<div class="line">c:\users\admin\appdata\local\programs\python\python36\lib\site-packages\pyspark\sql\session.py:378: UserWarning: inferring schema from dict is deprecated,please use pyspark.sql.Row instead</div>
<div class="line">  warnings.warn(&quot;inferring schema from dict is deprecated,&quot;</div>
<div class="line">c:\users\admin\appdata\local\programs\python\python36\lib\socket.py:657: ResourceWarning: unclosed &lt;socket.socket fd=1064, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=(&#39;127.0.0.1&#39;, 59336), raddr=(&#39;127.0.0.1&#39;, 59335)&gt;</div>
<div class="line">  self._sock = None</div>
<div class="line">...</div>
<div class="line">----------------------------------------------------------------------</div>
<div class="line">Ran 6 tests in 9.213s</div>
<div class="line"> </div>
<div class="line">OK</div>
</div><!-- fragment --><p>To get report of code coverage </p><div class="fragment"><div class="line">coverage report</div>
</div><!-- fragment --><p>Output: </p><div class="fragment"><div class="line">Name                       Stmts   Miss  Cover</div>
<div class="line">----------------------------------------------</div>
<div class="line">HelloFresh\__init__.py         2      0   100%</div>
<div class="line">HelloFresh\hellofresh.py      96      3    97%</div>
<div class="line">test.py                       42      0   100%</div>
<div class="line">----------------------------------------------</div>
<div class="line">TOTAL                        140      3    98%</div>
</div><!-- fragment --><p>To generate report as HTML run the following command. Output of html report is placed in htmlcov dir. </p><div class="fragment"><div class="line">coverage html</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
